<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Halide: Testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Halide<span id="projectnumber">&#160;19.0.0</span>
   </div>
   <div id="projectbrief">Halide compiler and libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2_testing.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Testing</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="testing"></a></p>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> uses CTest as its primary test platform and runner.</p>
<h1><a class="anchor" id="organization"></a>
Organization</h1>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s tests are organized beneath the top-level <code>test/</code> directory. These folders are described below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Folder   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>autoschedulers/$AS</code>   </td><td class="markdownTableBodyNone">Test for the <code>$AS</code> (e.g. <code>adams2019</code>) autoscheduler    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>common</code>   </td><td class="markdownTableBodyNone">Code that may be shared across multiple tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>correctness</code>   </td><td class="markdownTableBodyNone">Tests that check correctness of various compiler properties    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>error</code>   </td><td class="markdownTableBodyNone">Tests that expect an exception to be thrown (or <code><a class="el" href="runtime__internal_8h.html#ac54f53dc342019e8db34f4aa581a5792">abort()</a></code> to be called)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>failing_with_issue</code>   </td><td class="markdownTableBodyNone">Correctness tests that are associated with a particular issue on GitHub    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>fuzz</code>   </td><td class="markdownTableBodyNone">Fuzz tests. Read more at <a class="el" href="md_doc_2_fuzz_testing.html">FuzzTesting.md</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>generator</code>   </td><td class="markdownTableBodyNone">Tests of <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s AOT compilation infrastructure.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>integration</code>   </td><td class="markdownTableBodyNone">Tests of <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s CMake package for downstream use, including cross compilation.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>performance</code>   </td><td class="markdownTableBodyNone">Tests that check that certain schedules indeed improve performance.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>runtime</code>   </td><td class="markdownTableBodyNone">Unit tests for the <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> runtime library    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>warning</code>   </td><td class="markdownTableBodyNone">Tests that expected warnings are indeed issued.   </td></tr>
</table>
<p>The tests in each of these directories are given CTest labels corresponding to the directory name. Thus, one can use <code>ctest -L generator</code> to run only the <code>generator</code> tests. The <code>performance</code> tests configure CTest to not run them concurrently with other tests (including each other).</p>
<p>The vast majority of our tests are simple C++ executables that link to <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>, perform some checks, and print the special line <code>Success!</code> upon successful completion. There are three main exceptions to this:</p>
<p>First, the <code>warning</code> tests are expected to print a line that reads <code>Warning:</code> and do not look for <code>Success!</code>.</p>
<p>Second, some tests cannot run in all scenarios; for example, a test that measures CUDA performance requires a CUDA-capable GPU. In these cases, tests are expected to print <code>[SKIP]</code> and exit and not print <code>Success!</code> or <code>Warning:</code>.</p>
<p>Finally, the <code>error</code> tests are expected to throw an (uncaught) exception that is not a <code><a class="el" href="struct_halide_1_1_internal_error.html" title="An error that occurs while compiling a Halide pipeline that Halide attributes to an internal compiler...">Halide::InternalError</a></code> (i.e. from a failing <code>internal_assert</code>). The logic for translating uncaught exceptions into successful tests is in <code>test/common/expect_abort.cpp</code>.</p>
<h1><a class="anchor" id="debugging-with-lldb"></a>
Debugging with LLDB</h1>
<p>We provide helpers for pretty-printing <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s IR types in LLDB. The <code>.lldbinit</code> file at the repository root will load automatically if you launch <code>lldb</code> from this directory and your <code>~/.lldbinit</code> file contains the line,</p>
<div class="fragment"><div class="line">settings set target.load-cwd-lldbinit true</div>
</div><!-- fragment --><p>If you prefer to avoid such global configuration, you can directly load the helpers with the LLDB command,</p>
<div class="fragment"><div class="line">command script import ./tools/lldbhalide.py</div>
</div><!-- fragment --><p>again assuming that the repository root is your current working directory.</p>
<p>To see the benefit of using these helpers, let us debug <code>correctness_bounds</code>:</p>
<div class="fragment"><div class="line">$ lldb ./build/test/correctness/correctness_bounds</div>
<div class="line">(lldb) breakpoint set --file bounds.cpp --line 18</div>
<div class="line">Breakpoint 1: where = correctness_bounds`main + 864 at bounds.cpp:18:12, address = 0x0000000100002054</div>
<div class="line">(lldb) run</div>
<div class="line">Process 29325 launched: &#39;/Users/areinking/dev/Halide/build/test/correctness/correctness_bounds&#39; (arm64)</div>
<div class="line">Defining function...</div>
<div class="line">Process 29325 stopped</div>
<div class="line">* thread #1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1</div>
<div class="line">    frame #0: 0x0000000100002054 correctness_bounds`main(argc=1, argv=0x000000016fdff160) at bounds.cpp:18:12</div>
<div class="line">   15       g(x, y) = min(x, y);</div>
<div class="line">   16       h(x, y) = clamp(x + y, 20, 100);</div>
<div class="line">   17   </div>
<div class="line">-&gt; 18       Var xo(&quot;xo&quot;), yo(&quot;yo&quot;), xi(&quot;xi&quot;), yi(&quot;yi&quot;);</div>
<div class="line">   19   </div>
<div class="line">   20       Target target = get_jit_target_from_environment();</div>
<div class="line">   21       if (target.has_gpu_feature()) {</div>
<div class="line">Target 0: (correctness_bounds) stopped.</div>
<div class="line">(lldb) </div>
</div><!-- fragment --><p>Now we can try to inspect the Func <code>h</code>. Without the helpers, we see:</p>
<div class="fragment"><div class="line">(lldb) v h</div>
<div class="line">(Halide::Func) {</div>
<div class="line">  func = {</div>
<div class="line">    contents = {</div>
<div class="line">      strong = (ptr = 0x0000600002486a20)</div>
<div class="line">      weak = nullptr</div>
<div class="line">      idx = 0</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  pipeline_ = {</div>
<div class="line">    contents = (ptr = 0x0000000000000000)</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>But if we load the helpers and try again, we get a much more useful output:</p>
<div class="fragment"><div class="line">(lldb) command script import ./tools/lldbhalide.py</div>
<div class="line">(lldb) v h</div>
<div class="line">... lots of output ...</div>
</div><!-- fragment --><p>The amount of output here is maybe a bit <em>too</em> much, but we gain the ability to more narrowly inspect data about the func:</p>
<div class="fragment"><div class="line">(lldb) v h.func.init_def.values</div>
<div class="line">...</div>
<div class="line">(std::vector&lt;Halide::Expr&gt;) h.func.init_def.values = size=1 {</div>
<div class="line">  [0] = max(min(x + y, 100), 20)</div>
<div class="line">}</div>
</div><!-- fragment --><p>These helpers are particularly useful when using graphical debuggers, such as the one found in CLion. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
