<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Halide: Building Halide with CMake</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Halide<span id="projectnumber">&#160;19.0.0</span>
   </div>
   <div id="projectbrief">Halide compiler and libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2_building_halide_with_c_make.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Building Halide with CMake</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="building-halide-with-cmake"></a></p>
<p>This is a detailed guide to building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> with CMake. If you want to learn how to use <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> in your own CMake projects, see <a class="el" href="md_doc_2_halide_c_make_package.html">HalideCMakePackage.md</a>. If you are looking for <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s CMake coding guidelines, see <a class="el" href="md_doc_2_code_style_c_make.html">CodeStyleCMake.md</a>.</p>
<ul>
<li><a class="el" href="#building-halide-with-cmake">Building Halide with CMake</a></li>
<li><a class="el" href="#installing-cmake">Installing CMake</a><ul>
<li><a class="el" href="#cross-platform">Cross-platform</a></li>
<li><a class="el" href="#windows">Windows</a></li>
<li><a class="el" href="#macos">macOS</a></li>
<li><a class="el" href="#ubuntu-linux">Ubuntu Linux</a></li>
<li><a class="el" href="#optional-install-ninja">Optional: Install Ninja</a></li>
</ul>
</li>
<li><a class="el" href="#dependencies">Dependencies</a><ul>
<li><a class="el" href="#summary">Summary</a></li>
<li><a class="el" href="#installing-dependencies">Installing dependencies</a><ul>
<li><a class="el" href="#vcpkg">vcpkg</a></li>
<li><a class="el" href="#windows-1">Windows</a></li>
<li><a class="el" href="#homebrew">Homebrew</a></li>
<li><a class="el" href="#ubuntu--debian">Ubuntu / Debian</a></li>
<li><a class="el" href="#python">Python</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="#building-halide">Building Halide</a><ul>
<li><a class="el" href="#basic-build">Basic build</a><ul>
<li><a class="el" href="#windows-2">Windows</a></li>
<li><a class="el" href="#macos-and-linux">macOS and Linux</a></li>
</ul>
</li>
<li><a class="el" href="#cmake-presets">CMake Presets</a><ul>
<li><a class="el" href="#common-presets">Common presets</a></li>
<li><a class="el" href="#vcpkg-presets">Vcpkg presets</a></li>
<li><a class="el" href="#sanitizer-presets">Sanitizer presets</a></li>
</ul>
</li>
<li><a class="el" href="#build-options">Build options</a></li>
<li><a class="el" href="#installing">Installing</a></li>
</ul>
</li>
<li><a class="el" href="#building-halide-with-pip">Building Halide with pip</a></li>
</ul>
<h1><a class="anchor" id="installing-cmake"></a>
Installing CMake</h1>
<p>This section covers installing a recent version of CMake and the correct dependencies for building and using <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>. If you have not used CMake before, we strongly suggest reading through the <a href="https://cmake.org/cmake/help/latest/">CMake documentation</a> first.</p>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> requires at least version 3.28. Fortunately, getting a recent version of CMake couldn't be easier, and there are multiple good options on any system to do so. Generally, one should always have the most recent version of CMake installed system-wide. CMake is committed to backwards compatibility and even the most recent release can build projects over a decade old.</p>
<h2><a class="anchor" id="cross-platform"></a>
Cross-platform</h2>
<p>Kitware provides packages for CMake on <a href="https://pypi.org/project/cmake/">PyPI</a> which can be installed via <code>pip</code> into a <a href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a>. There are binary wheels available for nearly all relevant platforms, including:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">OS   </th><th class="markdownTableHeadNone">x86-32   </th><th class="markdownTableHeadNone">x86-64   </th><th class="markdownTableHeadNone">ARM64    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Windows   </td><td class="markdownTableBodyNone">:white_check_mark:   </td><td class="markdownTableBodyNone">:white_check_mark:   </td><td class="markdownTableBodyNone">:white_check_mark:    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">macOS   </td><td class="markdownTableBodyNone">:x:   </td><td class="markdownTableBodyNone">10.10+   </td><td class="markdownTableBodyNone">11.0+ (incl. <code>universal2</code>)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Linux (musl 1.1+)   </td><td class="markdownTableBodyNone">:white_check_mark:   </td><td class="markdownTableBodyNone">:white_check_mark:   </td><td class="markdownTableBodyNone">:white_check_mark:    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Linux (glibc)   </td><td class="markdownTableBodyNone">glibc 2.12+   </td><td class="markdownTableBodyNone">glibc 2.12+   </td><td class="markdownTableBodyNone">glibc 2.17+   </td></tr>
</table>
<p>We recommend installing CMake using <a href="https://pipx.pypa.io/stable/">pipx</a> to avoid package conflicts and redundant installations. After installing pipx, run:</p>
<div class="fragment"><div class="line">$ pipx install cmake</div>
</div><!-- fragment --><p>Alternatively, you can use a normal virtual environment:</p>
<div class="fragment"><div class="line">$ python -m pip install cmake</div>
</div><!-- fragment --><p>If you don't want Python to manage your CMake installation, you can either follow the platform-specific instructions below or install CMake from <a href="https://cmake.org/download/">Kitware's binary releases</a>. If all else fails, you might need to build CMake from source (e.g. on 32-bit ARM). In that case, follow the directions posted on <a href="https://cmake.org/install/">Kitware's website</a>.</p>
<h2><a class="anchor" id="windows"></a>
Windows</h2>
<p>On Windows, there are two primary methods for installing an up-to-date CMake:</p>
<ol type="1">
<li>You can get CMake through the Visual Studio 2022 installer.</li>
<li>You can use Windows's built-in package manager, <a href="https://learn.microsoft.com/en-us/windows/package-manager/winget/">winget</a>: <div class="fragment"><div class="line">winget install Kitware.CMake</div>
</div><!-- fragment --></li>
</ol>
<p>We prefer the first option for its simplicity. See Microsoft's <a href="https://docs.microsoft.com/en-us/cpp/build/cmake-projects-in-visual-studio">documentation</a> for more details.</p>
<h2><a class="anchor" id="macos"></a>
macOS</h2>
<p><a href="https://brew.sh">Homebrew</a> keeps its <a href="https://formulae.brew.sh/cask/cmake#default">CMake package</a> up to date. Simply run:</p>
<div class="fragment"><div class="line">$ brew install cmake</div>
</div><!-- fragment --><h2><a class="anchor" id="ubuntu-linux"></a>
Ubuntu Linux</h2>
<p>There are a few good ways to install CMake on Ubuntu:</p>
<ol type="1">
<li>If you're running 24.04 LTS, then simply running <code>sudo apt install cmake</code> will install CMake 3.28.</li>
<li>If you're running an older LTS or would like to use the newest CMake, try installing via the <a href="https://snapcraft.io/cmake">snap store</a>: <code>snap install cmake</code>. Note this will conflict with an APT-provided CMake.</li>
<li>Kitware also provides an <a href="https://apt.kitware.com/">APT repository</a> with up-to-date releases. Compatible with 20.04 LTS+ and is the best option for 32-bit ARM.</li>
</ol>
<p>For other Linux distributions, check with your distribution's package manager.</p>
<p><b>Note:</b> On WSL 1, snap is not available; in this case, prefer to use APT. On WSL 2, all methods are available.</p>
<h2><a class="anchor" id="optional-install-ninja"></a>
Optional: Install Ninja</h2>
<p>We strongly recommend using <a href="https://ninja-build.org/">Ninja</a> as your go-to CMake generator for working with <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>. It has a much richer dependency structure than the alternatives, and it is the only generator capable of producing accurate incremental builds.</p>
<p>It is available in most package repositories:</p>
<ul>
<li>Python: <code>pipx install ninja</code></li>
<li>Visual Studio Installer: alongside CMake</li>
<li>winget: <code>winget install Ninja-build.Ninja</code></li>
<li>Homebrew: <code>brew install ninja</code></li>
<li>APT: <code>apt install ninja-build</code></li>
</ul>
<p>You can also place a <a href="https://github.com/ninja-build/ninja/releases">pre-built binary</a> from their website in the PATH.</p>
<h1><a class="anchor" id="dependencies"></a>
Dependencies</h1>
<h2><a class="anchor" id="summary"></a>
Summary</h2>
<p>The following is a complete list of required and optional dependencies for building the core pieces of <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependency   </th><th class="markdownTableHeadNone">Version   </th><th class="markdownTableHeadNone">Required when...   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://github.com/llvm/llvm-project">LLVM</a>   </td><td class="markdownTableBodyNone"><em>see policy below</em>   </td><td class="markdownTableBodyNone"><em>always</em>   </td><td class="markdownTableBodyNone">WebAssembly and X86 targets are required.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://clang.llvm.org">Clang</a>   </td><td class="markdownTableBodyNone"><code>==LLVM</code>   </td><td class="markdownTableBodyNone"><em>always</em>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://lld.llvm.org/">LLD</a>   </td><td class="markdownTableBodyNone"><code>==LLVM</code>   </td><td class="markdownTableBodyNone"><em>always</em>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://github.com/google/flatbuffers">flatbuffers</a>   </td><td class="markdownTableBodyNone"><code>~=23.5.26</code>   </td><td class="markdownTableBodyNone"><code>WITH_SERIALIZATION=ON</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://github.com/WebAssembly/wabt">wabt</a>   </td><td class="markdownTableBodyNone"><code>==1.0.36</code>   </td><td class="markdownTableBodyNone"><code>Halide_WASM_BACKEND=wabt</code>   </td><td class="markdownTableBodyNone">Does not have a stable API; exact version required.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://v8.dev">V8</a>   </td><td class="markdownTableBodyNone">trunk   </td><td class="markdownTableBodyNone"><code>Halide_WASM_BACKEND=V8</code>   </td><td class="markdownTableBodyNone">Difficult to build. See <a class="el" href="md_doc_2_web_assembly.html">WebAssembly.md</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://www.python.org/downloads/">Python</a>   </td><td class="markdownTableBodyNone"><code>&gt;=3.8</code>   </td><td class="markdownTableBodyNone"><code>WITH_PYTHON_BINDINGS=ON</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://github.com/pybind/pybind11">pybind11</a>   </td><td class="markdownTableBodyNone"><code>~=2.10.4</code>   </td><td class="markdownTableBodyNone"><code>WITH_PYTHON_BINDINGS=ON</code>   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> maintains the following compatibility policy with LLVM: <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> version <code>N</code> supports LLVM versions <code>N</code>, <code>N-1</code>, and <code>N-2</code>. Our binary distributions always include the latest <code>N</code> patch at time of release. For most users, we recommend using a pre-packaged binary release of LLVM rather than trying to build it yourself.</p>
<p>To build the apps, documentation, and tests, an extended set is needed.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Dependency   </th><th class="markdownTableHeadNone">Required when...   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindCUDAToolkit.html">CUDA Toolkit</a>   </td><td class="markdownTableBodyNone">building <code>apps/cuda_mat_mul</code>   </td><td class="markdownTableBodyNone">When compiling <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> pipelines that use CUDA, only the drivers are needed.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindDoxygen.html">Doxygen</a>   </td><td class="markdownTableBodyNone"><code>WITH_DOCS=ON</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://eigen.tuxfamily.org/dox/TopicCMakeGuide.html">Eigen3</a>   </td><td class="markdownTableBodyNone">building <code>apps/linear_algebra</code>   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindJPEG.html">libjpeg</a>   </td><td class="markdownTableBodyNone"><code>WITH_TESTS=ON</code>   </td><td class="markdownTableBodyNone">Optionally used by <code>halide_image_io.h</code> and <code>Halide::ImageIO</code> in CMake.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindPNG.html">libpng</a>   </td><td class="markdownTableBodyNone"><code>WITH_TESTS=ON</code>   </td><td class="markdownTableBodyNone">(same as libjpeg)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindBLAS.html">BLAS</a>   </td><td class="markdownTableBodyNone">building <code>apps/linear_algebra</code>   </td><td class="markdownTableBodyNone"><a href="http://math-atlas.sourceforge.net/">ATLAS</a> and <a href="https://www.openblas.net/">OpenBLAS</a> are supported implementations    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindOpenCL.html">OpenCL</a>   </td><td class="markdownTableBodyNone">compiling pipelines with <code>opencl</code>   </td><td class="markdownTableBodyNone"></td></tr>
</table>
<p>It is best practice to configure your environment so that CMake can find dependencies without package-specific hints. For instance, if you want CMake to use a particular version of Python, create a virtual environment and activate it <em>before</em> configuring <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>. Similarly, the <code>CMAKE_PREFIX_PATH</code> variable can be set to a local directory where from-source dependencies have been installed. Carefully consult the <a href="https://cmake.org/cmake/help/latest/command/find_package.html">find_package</a> documentation to learn how the search procedure works.</p>
<p>If the build still fails to find a dependency, each package provides a bespoke interface for providing hints and overriding incorrect results. Documentation for these packages is linked in the table above.</p>
<h2><a class="anchor" id="installing-dependencies"></a>
Installing dependencies</h2>
<h3><a class="anchor" id="vcpkg"></a>
vcpkg</h3>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> has first-class support for using <a href="https://github.com/Microsoft/vcpkg">vcpkg</a> to manage dependencies. The list of dependencies and features is contained inside <code>vcpkg.json</code> at the root of the repository.</p>
<p>By default, a minimum set of LLVM backends will be enabled to compile JIT code for the host and the serialization feature will be enabled. When using the vcpkg toolchain file, you can set <code>-DVCPKG_MANIFEST_FEATURES=developer</code> to enable building all dependencies (except Doxygen, which is not available on vcpkg).</p>
<p>By default, running <code>vcpkg install</code> will try to build all of LLVM. This is often undesirable as it takes very long to do and consumes a lot of disk space, especially as <code>vcpkg</code> requires special configuration to disable the debug build. It will <em>also</em> attempt to build Python 3 as a dependency of pybind11.</p>
<p>To mitigate this issue, we provide a <a href="https://learn.microsoft.com/en-us/vcpkg/concepts/overlay-ports">vcpkg-overlay</a> that disables building LLVM and Python. When using the vcpkg toolchain, you can enable it by setting <code>-DVCPKG_OVERLAY_PORTS=cmake/vcpkg</code>.</p>
<p>If you do choose to use vcpkg to build LLVM (the easiest way on Windows), note that it is safe to delete the intermediate build files and caches in <code>D:\vcpkg\buildtrees</code> and <code>APPDATA%\local\vcpkg</code>.</p>
<p>For convenience, we provide <a class="el" href="#cmake-presets">CMake presets</a> that set these flags appropriately per-platform. They are documented further below.</p>
<h3><a class="anchor" id="windows-1"></a>
Windows</h3>
<p>On Windows, we recommend using <code>vcpkg</code> to install library dependencies.</p>
<p>To build the documentation, you will need to install <a href="https://www.doxygen.nl/index.html">Doxygen</a>. This can be done either from the <a href="https://www.doxygen.nl/download.html">Doxygen website</a> or through <a href="https://learn.microsoft.com/en-us/windows/package-manager/winget/">winget</a>:</p>
<div class="fragment"><div class="line">$ winget install DimitriVanHeesch.Doxygen</div>
</div><!-- fragment --><p>To build the Python bindings, you will need to install Python 3. This should be done by running the official installer from the <a href="https://www.python.org/downloads/">Python website</a>. Be sure to download the debugging symbols through the installer. This will require using the "Advanced Installation" workflow. Although it is not strictly necessary, it is convenient to install Python system-wide on Windows (i.e. <code>C:\Program Files</code>) because CMake looks at standard paths and registry keys. This removes the need to manually set the <code>PATH</code>.</p>
<p>Once Python is installed, you can install the Python module dependencies either globally or in a <a href="https://docs.python.org/3/tutorial/venv.html">virtual environment</a> by running</p>
<div class="fragment"><div class="line">$ python -m pip install -r requirements.txt</div>
</div><!-- fragment --><p>from the root of the repository.</p>
<h3><a class="anchor" id="homebrew"></a>
Homebrew</h3>
<p>On macOS, it is possible to install all dependencies via <a href="https://brew.sh">Homebrew</a>:</p>
<div class="fragment"><div class="line">$ brew install llvm flatbuffers wabt python pybind11 doxygen eigen libpng libjpeg openblas</div>
</div><!-- fragment --><p>The <code>llvm</code> package includes <code>clang</code>, <code>clang-format</code>, and <code>lld</code>, too. To ensure CMake can find the keg-only dependencies, set the following:</p>
<div class="fragment"><div class="line">$ export CMAKE_PREFIX_PATH=&quot;/opt/homebrew:/opt/homebrew/opt/llvm:/opt/homebrew/opt/jpeg&quot;</div>
</div><!-- fragment --><h3><a class="anchor" id="ubuntu--debian"></a>
Ubuntu / Debian</h3>
<p>On Ubuntu you should install the following packages (this includes the Python module dependencies):</p>
<div class="fragment"><div class="line">$ sudo apt install clang-tools lld llvm-dev libclang-dev liblld-dev \</div>
<div class="line">    libpng-dev libjpeg-dev libgl-dev python3-dev python3-numpy python3-scipy \</div>
<div class="line">    python3-imageio python3-pybind11 libopenblas-dev libeigen3-dev \ </div>
<div class="line">    libatlas-base-dev doxygen</div>
</div><!-- fragment --><h3><a class="anchor" id="python"></a>
Python</h3>
<p>When running the Python package, you will need to install additional dependencies. These are tabulated in <code>requirements.txt</code> and may be installed with:</p>
<div class="fragment"><div class="line">$ python -m pip install -U pip &quot;setuptools[core]&quot; wheel</div>
<div class="line">$ python -m pip install -r requirements.txt</div>
</div><!-- fragment --><h1><a class="anchor" id="building-halide"></a>
Building Halide</h1>
<h2><a class="anchor" id="basic-build"></a>
Basic build</h2>
<p>These instructions assume that your working directory is the <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> repository root.</p>
<h3><a class="anchor" id="windows-2"></a>
Windows</h3>
<p>If you plan to use the Ninja generator, be sure to launch the developer command prompt corresponding to your intended environment. Note that whatever your intended target system (x86, x64, or ARM), you must use the 64-bit <em>host tools</em> because the 32-bit tools run out of memory during the linking step with LLVM. More information is available from <a href="https://learn.microsoft.com/en-us/cpp/build/building-on-the-command-line">Microsoft's documentation</a>.</p>
<p>You should either open the correct Developer Command Prompt directly or run the <a href="https://docs.microsoft.com/en-us/cpp/build/building-on-the-command-line#developer_command_file_locations"><code>vcvarsall.bat</code></a> script with the correct argument, i.e. one of the following:</p>
<div class="fragment"><div class="line">$ &quot;C:\Program Files (x86)\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsall.bat&quot; x64</div>
<div class="line">$ &quot;C:\Program Files (x86)\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsall.bat&quot; x64_x86</div>
<div class="line">$ &quot;C:\Program Files (x86)\Microsoft Visual Studio\2022\Community\VC\Auxiliary\Build\vcvarsall.bat&quot; x64_arm</div>
</div><!-- fragment --><p>Then, assuming that vcpkg is installed to <code>D:\vcpkg</code>, simply run:</p>
<div class="fragment"><div class="line">$ cmake -G Ninja -S . -B build --toolchain D:\vcpkg\scripts\buildsystems\vcpkg.cmake -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">$ cmake --build .\build</div>
</div><!-- fragment --><p>Valid values of <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html"><code>CMAKE_BUILD_TYPE</code></a> are <code>Debug</code>, <code>RelWithDebInfo</code>, <code>MinSizeRel</code>, and <code>Release</code>. When using a single-configuration generator (like Ninja) you must specify a build type in the configuration step.</p>
<p>Otherwise, if you wish to create a Visual Studio based build system, you can configure with:</p>
<div class="fragment"><div class="line">$ cmake -G &quot;Visual Studio 17 2022&quot; -Thost=x64 -A x64 -S . -B build ^</div>
<div class="line">        --toolchain D:\vcpkg\scripts\buildsystems\vcpkg.cmake</div>
<div class="line">$ cmake --build .\build --config Release -j %NUMBER_OF_PROCESSORS%</div>
</div><!-- fragment --><p>Because the Visual Studio generator is a <em>multi-config generator</em>, you don't set <code>CMAKE_BUILD_TYPE</code> at configure-time, but instead pass the configuration to the build (and test/install) commands with the <code>--config</code> flag. More documentation is available in the <a href="https://cmake.org/cmake/help/latest/guide/user-interaction/index.html#setting-build-variables">CMake User Interaction Guide</a>.</p>
<p>The process is similar for 32-bit:</p>
<div class="fragment"><div class="line">&gt; cmake -G &quot;Visual Studio 17 2022&quot; -Thost=x64 -A Win32 -S . -B build ^</div>
<div class="line">        --toolchain D:\vcpkg\scripts\buildsystems\vcpkg.cmake</div>
<div class="line">&gt; cmake --build .\build --config Release -j %NUMBER_OF_PROCESSORS%</div>
</div><!-- fragment --><p>In both cases, the <code>-Thost=x64</code> flag ensures that the correct host tools are used.</p>
<p><b>Note:</b> due to limitations in MSBuild, incremental builds using the VS generators will miss dependencies (including changes to headers in the <code>src/runtime</code> folder). We recommend using Ninja for day-to-day development and use Visual Studio only if you need it for packaging.</p>
<h3><a class="anchor" id="macos-and-linux"></a>
macOS and Linux</h3>
<p>The instructions here are straightforward. Assuming your environment is set up correctly, just run:</p>
<div class="fragment"><div class="line">$ cmake -G Ninja -S . -B build -DCMAKE_BUILD_TYPE=Release</div>
<div class="line">$ cmake --build build</div>
</div><!-- fragment --><p>If you omit <code>-G Ninja</code>, a Makefile-based generator will likely be used instead. In either case, <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html"><code>CMAKE_BUILD_TYPE</code></a> must be set to one of the standard types: <code>Debug</code>, <code>RelWithDebInfo</code>, <code>MinSizeRel</code>, or <code>Release</code>.</p>
<h2><a class="anchor" id="cmake-presets"></a>
CMake Presets</h2>
<h3><a class="anchor" id="common-presets"></a>
Common presets</h3>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> provides several <a href="https://cmake.org/cmake/help/latest/manual/cmake-presets.7.html">presets</a> to make the above commands more convenient. The following CMake preset commands correspond to the longer ones above.</p>
<div class="fragment"><div class="line">$ cmake --preset=win64    # VS 2022 generator, 64-bit build, vcpkg deps</div>
<div class="line">$ cmake --preset=win32    # VS 2022 generator, 32-bit build, vcpkg deps</div>
<div class="line">$ cmake --preset=macOS    # Ninja generator, macOS host build, Homebrew deps</div>
<div class="line">$ cmake --preset=debug    # Debug mode, any single-config generator / compiler</div>
<div class="line">$ cmake --preset=release  # Release mode, any single-config generator / compiler</div>
</div><!-- fragment --><h3><a class="anchor" id="vcpkg-presets"></a>
Vcpkg presets</h3>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> provides two sets of corresponding vcpkg-enabled presets: <em>base</em> and <em>full</em>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Base preset   </th><th class="markdownTableHeadNone">Full preset    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>win32</code>   </td><td class="markdownTableBodyNone"><code>win32-vcpkg-full</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>win64</code>   </td><td class="markdownTableBodyNone"><code>win64-vcpkg-full</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>macOS-vcpkg</code>   </td><td class="markdownTableBodyNone"><code>macOS-vcpkg-full</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>debug-vcpkg</code>   </td><td class="markdownTableBodyNone"><code>debug-vcpkg-full</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>release-vcpkg</code>   </td><td class="markdownTableBodyNone"><code>release-vcpkg-full</code>   </td></tr>
</table>
<p>In simple terms, the base presets rely on the system to provide LLVM and Python, while the full presets delegate this to vcpkg (which consumes a large amount of hard disk space and time).</p>
<p>The <code>macOS-vcpkg</code> preset adds <code>/opt/homebrew/opt/llvm</code> to <code>CMAKE_PREFIX_PATH</code>.</p>
<h3><a class="anchor" id="sanitizer-presets"></a>
Sanitizer presets</h3>
<p>There are also presets to use some Clang sanitizers with the CMake build; at present, only Fuzzer and ASAN (Address Sanitizer) are supported, and only on linux-x86-64.</p>
<ul>
<li><code>linux-x64-asan</code>: Use the Address Sanitizer</li>
<li><code>linux-x64-fuzzer</code>: Use the Clang fuzzer plugin</li>
</ul>
<p>To use these, you must build LLVM with additional options:</p>
<div class="fragment"><div class="line">-DLLVM_ENABLE_PROJECTS=&quot;clang;lld;clang-tools-extra&quot;</div>
<div class="line">-DLLVM_ENABLE_RUNTIMES=&quot;compiler-rt;libcxx;libcxxabi;libunwind&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="build-options"></a>
Build options</h2>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> reads and understands several options that can configure the build. The following are the most consequential and control how <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> is actually compiled.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/BUILD_SHARED_LIBS.html"><code>BUILD_SHARED_LIBS</code></a>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Standard CMake variable that chooses whether to build as a static or shared library.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Halide_BUNDLE_STATIC</code>   </td><td class="markdownTableBodyNone"><code>OFF</code>   </td><td class="markdownTableBodyNone">When building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> as a static library, merge static library dependencies into libHalide.a.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_LLVM_SHARED_LIBS</code>   </td><td class="markdownTableBodyNone"><code>OFF</code>   </td><td class="markdownTableBodyNone">Link to the shared version of LLVM. Not available on Windows.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Halide_ENABLE_RTTI</code>   </td><td class="markdownTableBodyNone"><em>inherited from LLVM</em>   </td><td class="markdownTableBodyNone">Enable RTTI when building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>. Recommended to be set to <code>ON</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_ENABLE_EXCEPTIONS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable exceptions when building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Halide_TARGET</code>   </td><td class="markdownTableBodyNone"><em>empty</em>   </td><td class="markdownTableBodyNone">The default target triple to use for <code>add_halide_library</code> (and the generator tests, by extension)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_AUTOSCHEDULERS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable building the autoschedulers. Requires <code>BUILD_SHARED_LIBS</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_SERIALIZATION</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Include experimental Serialization/Deserialization features   </td></tr>
</table>
<p>The following options are disabled by default when building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> through the <a href="https://cmake.org/cmake/help/latest/command/add_subdirectory.html"><code>add_subdirectory</code></a> or <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><code>FetchContent</code></a> mechanisms. They control whether non-essential targets (like tests and documentation) are built.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_DOCS</code>   </td><td class="markdownTableBodyNone"><code>OFF</code>   </td><td class="markdownTableBodyNone">Enable building the documentation via Doxygen    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_PACKAGING</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Include the <code>install()</code> rules for <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_PYTHON_BINDINGS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable building Python 3 bindings    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_TESTS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable building unit and integration tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_TUTORIALS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable building the tutorials    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_UTILS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">Enable building various utilities including the trace visualizer   </td></tr>
</table>
<p>The following options are <em>advanced</em> and should not be required in typical workflows. Generally, these are used by <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s own CI infrastructure, or as escape hatches for third-party packagers.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_CLANG_TIDY_BUILD</code>   </td><td class="markdownTableBodyNone"><code>OFF</code>   </td><td class="markdownTableBodyNone">Used internally to generate fake compile jobs for runtime files when running clang-tidy.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Halide_CCACHE_BUILD</code>   </td><td class="markdownTableBodyNone"><code>OFF</code>   </td><td class="markdownTableBodyNone">Use ccache with Halide-recommended settings to accelerate rebuilds.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_CCACHE_PARAMS</code>   </td><td class="markdownTableBodyNone"><code>CCACHE_CPP2=yes CCACHE_HASHDIR=yes CCACHE_SLOPPINESS=pch_defines</code>   </td><td class="markdownTableBodyNone">Options to pass to <code>ccache</code> when using <code>Halide_CCACHE_BUILD</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Halide_VERSION_OVERRIDE</code>   </td><td class="markdownTableBodyNone"><code>${Halide_VERSION}</code>   </td><td class="markdownTableBodyNone">Override the VERSION for libHalide.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_SOVERSION_OVERRIDE</code>   </td><td class="markdownTableBodyNone"><code>${Halide_VERSION_MAJOR}</code>   </td><td class="markdownTableBodyNone">Override the SOVERSION for libHalide. Expects a positive integer (i.e. not a version).   </td></tr>
</table>
<p>The following options control whether to build certain test subsets. They only apply when <code>WITH_TESTS=ON</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_TEST_AUTO_SCHEDULE</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable the auto-scheduling tests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_TEST_CORRECTNESS</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable the correctness tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_TEST_ERROR</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable the expected-error tests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_TEST_FUZZ</code>   </td><td class="markdownTableBodyNone"><em>detected</em>   </td><td class="markdownTableBodyNone">enable the libfuzzer-based fuzz tests    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_TEST_GENERATOR</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable the AOT generator tests    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_TEST_PERFORMANCE</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable performance testing    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>WITH_TEST_RUNTIME</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable testing the runtime modules    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>WITH_TEST_WARNING</code>   </td><td class="markdownTableBodyNone"><code>ON</code>   </td><td class="markdownTableBodyNone">enable the expected-warning tests   </td></tr>
</table>
<p>The following option selects the execution engine for in-process WASM testing:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Halide_WASM_BACKEND</code>   </td><td class="markdownTableBodyNone"><code>wabt</code>   </td><td class="markdownTableBodyNone">Select the backend for WASM testing. Can be <code>wabt</code>, <code>V8</code> or a false value such as <code>OFF</code>.   </td></tr>
</table>
<h2><a class="anchor" id="installing"></a>
Installing</h2>
<p>Once built, <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> will need to be installed somewhere before using it in a separate project. On any platform, this means running the <a href="https://cmake.org/cmake/help/latest/manual/cmake.1.html#install-a-project"><code>cmake --install</code></a> command in one of two ways. For a single-configuration generator (like Ninja), run either:</p>
<div class="fragment"><div class="line">$ cmake --install ./build --prefix /path/to/Halide-install</div>
<div class="line">$ cmake --install .\build --prefix X:\path\to\Halide-install</div>
</div><!-- fragment --><p>For a multi-configuration generator (like Visual Studio) run:</p>
<div class="fragment"><div class="line">$ cmake --install ./build --prefix /path/to/Halide-install --config Release</div>
<div class="line">$ cmake --install .\build --prefix X:\path\to\Halide-install --config Release</div>
</div><!-- fragment --><p>Of course, make sure that you build the corresponding config before attempting to install it.</p>
<h1><a class="anchor" id="building-halide-with-pip"></a>
Building Halide with pip</h1>
<p><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> also supports installation via the standard Python packaging workflow. Running <code>pip install .</code> at the root of the repository will build a wheel and install it into the currently active Python environment.</p>
<p>However, this comes with a few caveats:</p>
<ol type="1">
<li><code>Halide_USE_FETCHCONTENT</code> is disabled, so the environment must be prepared for CMake to find its dependencies. This is easiest to do by setting either <code>CMAKE_PREFIX_PATH</code> to pre-built dependencies or by setting <code>CMAKE_TOOLCHAIN_FILE</code> to vcpkg.</li>
<li>The build settings are fixed, meaning that <code>wabt</code> is required on non-Windows systems, <code>flatbuffers</code> is always required, and the Python bindings must be built.</li>
<li>The generated wheel will likely only work on your system. In particular, it will not be repaired with <code>auditwheel</code> or <code>delocate</code>.</li>
</ol>
<p>Even so, this is a very good method of installing <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>. It supports both Python and C++ <code>find_package</code> workflows. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
