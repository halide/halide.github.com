<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Halide: Contributing CMake code to Halide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Halide<span id="projectnumber">&#160;19.0.0</span>
   </div>
   <div id="projectbrief">Halide compiler and libraries</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2_code_style_c_make.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Contributing CMake code to Halide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="contributing-cmake-code-to-halide"></a></p>
<p>This document specifies the coding standards we adhere to when authoring new CMake code. If you need directions for building <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>, see <a class="el" href="md_doc_2_building_halide_with_c_make.html">BuildingHalideWithCMake.md</a>. If you are looking for <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s CMake package documentation, see <a class="el" href="md_doc_2_halide_c_make_package.html">HalideCMakePackage.md</a>.</p>
<p>This document is necessary for two major reasons. First, due to its long history, size, and dedication to backwards compatibility, CMake is <em>incredibly</em> difficult to learn and full of traps. Second, <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> bundles its own LLVM-based native code generator, which CMake deeply does not expect. This means we routinely push CMake's build model to its limit.</p>
<p>Therefore, we must be careful to write high-quality CMake code so that it is clear when CMake's limitations are being tested. While not comprehensive, the guide outlines the code quality expectations we have as they apply to CMake.</p>
<p>When contributing new CMake code to <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>, keep in mind that the minimum version is 3.28. Therefore, it is not only possible, but <em>required</em>, to use modern CMake best practices.</p>
<ul>
<li><a class="el" href="#contributing-cmake-code-to-halide">Contributing CMake code to Halide</a></li>
<li><a class="el" href="#general-guidelines-and-best-practices">General guidelines and best practices</a><ul>
<li><a class="el" href="#prohibited-commands-list">Prohibited commands list</a></li>
<li><a class="el" href="#prohibited-variables-list">Prohibited variables list</a></li>
</ul>
</li>
<li><a class="el" href="#adding-tests">Adding tests</a></li>
<li><a class="el" href="#adding-apps">Adding apps</a></li>
</ul>
<h1><a class="anchor" id="general-guidelines-and-best-practices"></a>
General guidelines and best practices</h1>
<p>The following are some common mistakes that lead to subtly broken builds.</p>
<ul>
<li><b>Reading the build directory.</b> While setting up the build, the build directory should be considered <em>write only</em>. Using the build directory as a read/write temporary directory is acceptable as long as all temp files are cleaned up by the end of configuration.</li>
<li><b>Not using <a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html">generator expressions</a>.</b> Declarative is better than imperative and this is no exception. Conditionally adding to a target property can leak unwanted details about the build environment into packages. Some information is not accurate or available except via generator expressions, e.g. the build configuration.</li>
<li><b>Using the wrong variable.</b> <code>CMAKE_SOURCE_DIR</code> doesn't always point to the <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> source root. When someone uses <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> via <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><code>FetchContent</code></a>, it will point to <em>their</em> source root instead. The correct variable is <a href="https://cmake.org/cmake/help/latest/variable/PROJECT-NAME_SOURCE_DIR.html"><code>Halide_SOURCE_DIR</code></a>. If you want to know if the compiler is MSVC, check it directly with the <a href="https://cmake.org/cmake/help/latest/variable/MSVC.html"><code>MSVC</code></a> variable; don't use <a href="https://cmake.org/cmake/help/latest/variable/WIN32.html"><code>WIN32</code></a>. That will be wrong when compiling with clang on Windows. In most cases, however, a generator expression will be more appropriate.</li>
<li><b>Using directory properties.</b> Directory properties have vexing behavior and are essentially deprecated from CMake 3.0+. Propagating target properties is the way of the future.</li>
<li><b>Using the wrong visibility.</b> Target properties can be <code>PRIVATE</code>, <code>INTERFACE</code>, or both (aka <code>PUBLIC</code>). Pick the most conservative one for each scenario. Refer to the <a href="https://cmake.org/cmake/help/latest/manual/cmake-buildsystem.7.html#transitive-usage-requirements">transitive usage requirements</a> docs for more information.</li>
<li><b>Needlessly expanding variables</b> The <a href="https://cmake.org/cmake/help/latest/command/if.html"><code>if</code></a> and <a href="https://cmake.org/cmake/help/latest/command/foreach.html"><code>foreach</code></a> commands generally expand variables when provided by name. Expanding such variables manually can unintentionally change the behavior of the command. Use <code>foreach (item IN LISTS list)</code> instead of <code>foreach (item ${list})</code>. Similarly, use <code>if (varA STREQUAL varB)</code> instead of <code>if ("${varA}" STREQUAL "${varB}")</code> and <em>definitely</em> don't use <code>if (${varA} STREQUAL ${varB})</code> since that will fail (in the best case) if either variable's value contains a semicolon (due to argument expansion).</li>
</ul>
<h2><a class="anchor" id="prohibited-commands-list"></a>
Prohibited commands list</h2>
<p>As mentioned above, using directory properties is brittle, and they are therefore <em>not allowed</em>. The following functions may not appear in any new CMake code.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Alternative    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>add_compile_definitions</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html"><code>target_compile_definitions</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>add_compile_options</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_compile_options.html"><code>target_compile_options</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>add_definitions</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html"><code>target_compile_definitions</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>add_link_options</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_link_options.html"><code>target_link_options</code></a>, but prefer not to use either    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>include_directories</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_include_directories.html"><code>target_include_directories</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>link_directories</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html"><code>target_link_libraries</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>link_libraries</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html"><code>target_link_libraries</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>remove_definitions</code>   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html">Generator expressions</a> in <a href="https://cmake.org/cmake/help/latest/command/target_compile_definitions.html"><code>target_compile_definitions</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>set_directory_properties</code>   </td><td class="markdownTableBodyNone">Use (cache) variables or target properties    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>set_property(DIRECTORY)</code>   </td><td class="markdownTableBodyNone">Use (cache) variables or target properties (custom properties excluded, but require justification)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>target_link_libraries(target lib)</code>   </td><td class="markdownTableBodyNone">Use <a href="https://cmake.org/cmake/help/latest/command/target_link_libraries.html"><code>target_link_libraries</code></a> <em>with a visibility specifier</em> (eg. <code>PRIVATE</code>)   </td></tr>
</table>
<p>As an example, it was once common practice to write code similar to this:</p>
<div class="fragment"><div class="line"># WRONG: do not do this</div>
<div class="line">include_directories(include)</div>
<div class="line">add_library(my_lib source1.cpp ..)</div>
</div><!-- fragment --><p>However, this has two major pitfalls. First, it applies to <em>all</em> targets created in that directory, even those before the call to <code>include_directories</code> and those created in <a href="https://cmake.org/cmake/help/latest/command/include.html"><code>include()</code></a>-ed CMake files. As CMake files get larger and more complex, this behavior gets harder to pinpoint. This is particularly vexing when using the <code>link_libraries</code> or <code>add_definitions</code> commands. Second, this form does not provide a way to <em>propagate</em> the include directory to consumers of <code>my_lib</code>. The correct way to do this is:</p>
<div class="fragment"><div class="line"># CORRECT</div>
<div class="line">add_library(my_lib source1.cpp ...)</div>
<div class="line">target_sources(</div>
<div class="line">    my_lib</div>
<div class="line">    PUBLIC</div>
<div class="line">    FILE_SET HEADERS</div>
<div class="line">    BASE_DIRS include</div>
<div class="line">    FILES include/header1.h</div>
<div class="line">)</div>
</div><!-- fragment --><p>This is better in many ways. It only affects the target in question. It propagates the include path to the targets linking to it (via <code>PUBLIC</code>). It also correctly exports the host-filesystem-specific include path when installing or packaging the target and installs the headers themselves, too.</p>
<p>If common properties need to be grouped together, use an INTERFACE target (better) or write a function (worse).</p>
<p>There are also several functions that are disallowed for other reasons:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Command   </th><th class="markdownTableHeadNone">Reason   </th><th class="markdownTableHeadNone">Alternative    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>aux_source_directory</code>   </td><td class="markdownTableBodyNone">Interacts poorly with incremental builds and Git   </td><td class="markdownTableBodyNone">List source files explicitly    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>build_command</code>   </td><td class="markdownTableBodyNone">CTest internal function   </td><td class="markdownTableBodyNone">Use CTest build-and-test mode via <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CTEST_COMMAND.html"><code>CMAKE_CTEST_COMMAND</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>cmake_host_system_information</code>   </td><td class="markdownTableBodyNone">Usually misleading information.   </td><td class="markdownTableBodyNone">Inspect <a href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">toolchain</a> variables and use generator expressions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cmake_policy(... OLD)</code>   </td><td class="markdownTableBodyNone">OLD policies are deprecated by definition.   </td><td class="markdownTableBodyNone">Instead, fix the code to work with the new policy.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>create_test_sourcelist</code>   </td><td class="markdownTableBodyNone">We use our own unit testing solution   </td><td class="markdownTableBodyNone">See the <a class="el" href="#adding-tests">adding tests</a> section.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>define_property</code>   </td><td class="markdownTableBodyNone">Adds unnecessary complexity   </td><td class="markdownTableBodyNone">Use a cache variable. Exceptions under special circumstances.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>enable_language</code>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> is C/C++ only   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/module/FindCUDAToolkit.html"><code>FindCUDAToolkit</code></a>, appropriately guarded.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>file(GLOB ...)</code>   </td><td class="markdownTableBodyNone">Interacts poorly with incremental builds and Git   </td><td class="markdownTableBodyNone">List source files explicitly. Allowed if not globbing for source files.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>fltk_wrap_ui</code>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> does not use FLTK   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>include_external_msproject</code>   </td><td class="markdownTableBodyNone"><a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a> must remain portable   </td><td class="markdownTableBodyNone">Write a CMake package config file or find module.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>include_guard</code>   </td><td class="markdownTableBodyNone">Use of recursive inclusion is not allowed   </td><td class="markdownTableBodyNone">Write (recursive) functions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>include_regular_expression</code>   </td><td class="markdownTableBodyNone">Changes default dependency checking behavior   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>load_cache</code>   </td><td class="markdownTableBodyNone">Superseded by <a href="https://cmake.org/cmake/help/latest/module/FetchContent.html"><code>FetchContent</code></a>/<a href="https://cmake.org/cmake/help/latest/module/ExternalProject.html"><code>ExternalProject</code></a>   </td><td class="markdownTableBodyNone">Use aforementioned modules    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>macro</code>   </td><td class="markdownTableBodyNone">CMake macros are not hygienic and are therefore error-prone   </td><td class="markdownTableBodyNone">Use functions instead.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>site_name</code>   </td><td class="markdownTableBodyNone">Privacy: do not want leak host name information   </td><td class="markdownTableBodyNone">Provide a cache variable, generate a unique name.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>variable_watch</code>   </td><td class="markdownTableBodyNone">Debugging helper   </td><td class="markdownTableBodyNone">None. Not needed in production.   </td></tr>
</table>
<p>Do not introduce any dependencies via <a href="https://cmake.org/cmake/help/latest/command/find_package.html"><code>find_package</code></a> without broader approval. Importantly, never introduce a new use of <code>FetchContent</code>; prefer to add dependencies to <code>vcpkg.json</code>.</p>
<h2><a class="anchor" id="prohibited-variables-list"></a>
Prohibited variables list</h2>
<p>Any variables that are specific to languages that are not enabled should, of course, be avoided. But of greater concern are variables that are easy to misuse or should not be overridden for our end-users. The following (non-exhaustive) list of variables shall not be used in code merged into main.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Reason   </th><th class="markdownTableHeadNone">Alternative    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_ROOT</code>   </td><td class="markdownTableBodyNone">Code smell   </td><td class="markdownTableBodyNone">Rely on <code>find_package</code> search options; include <code>HINTS</code> if necessary    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_DEBUG_TARGET_PROPERTIES</code>   </td><td class="markdownTableBodyNone">Debugging helper   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_FIND_DEBUG_MODE</code>   </td><td class="markdownTableBodyNone">Debugging helper   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_RULE_MESSAGES</code>   </td><td class="markdownTableBodyNone">Debugging helper   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_VERBOSE_MAKEFILE</code>   </td><td class="markdownTableBodyNone">Debugging helper   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_BACKWARDS_COMPATIBILITY</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_BUILD_TOOL</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><code>${CMAKE_COMMAND} --build</code> or <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_MAKE_PROGRAM.html"><code>CMAKE_MAKE_PROGRAM</code></a> (but see below)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_CACHEFILE_DIR</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BINARY_DIR.html"><code>CMAKE_BINARY_DIR</code></a>, but see below    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_CFG_INTDIR</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><code>$&lt;CONFIG&gt;</code>, <code>$&lt;TARGET_FILE:..&gt;</code>, target resolution of <a href="https://cmake.org/cmake/help/latest/command/add_custom_command.html"><code>add_custom_command</code></a>, etc.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_CL_64</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SIZEOF_VOID_P.html"><code>CMAKE_SIZEOF_VOID_P</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_COMPILER_IS_*</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER_ID.html"><code>CMAKE_&lt;LANG&gt;_COMPILER_ID</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_HOME_DIRECTORY</code>   </td><td class="markdownTableBodyNone">Deprecated   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SOURCE_DIR.html"><code>CMAKE_SOURCE_DIR</code></a>, but see below    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_DIRECTORY_LABELS</code>   </td><td class="markdownTableBodyNone">Directory property   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_BUILD_TYPE</code>   </td><td class="markdownTableBodyNone">Only applies to single-config generators.   </td><td class="markdownTableBodyNone"><code>$&lt;CONFIG&gt;</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_*_FLAGS*</code> (w/o <code>_INIT</code>)   </td><td class="markdownTableBodyNone">User-only   </td><td class="markdownTableBodyNone">Write a <a href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">toolchain</a> file with the corresponding <code>_INIT</code> variable    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_COLOR_MAKEFILE</code>   </td><td class="markdownTableBodyNone">User-only   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>CMAKE_ERROR_DEPRECATED</code>   </td><td class="markdownTableBodyNone">User-only   </td><td class="markdownTableBodyNone">None    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>CMAKE_CONFIGURATION_TYPES</code>   </td><td class="markdownTableBodyNone">We only support the four standard build types   </td><td class="markdownTableBodyNone">None   </td></tr>
</table>
<p>Of course feel free to insert debugging helpers <em>while developing</em> but please remove them before review. Finally, the following variables are allowed, but their use must be motivated:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable   </th><th class="markdownTableHeadNone">Reason   </th><th class="markdownTableHeadNone">Alternative    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SOURCE_DIR.html"><code>CMAKE_SOURCE_DIR</code></a>   </td><td class="markdownTableBodyNone">Points to global source root, not <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s.   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/PROJECT-NAME_SOURCE_DIR.html"><code>Halide_SOURCE_DIR</code></a> or <a href="https://cmake.org/cmake/help/latest/variable/PROJECT_SOURCE_DIR.html"><code>PROJECT_SOURCE_DIR</code></a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BINARY_DIR.html"><code>CMAKE_BINARY_DIR</code></a>   </td><td class="markdownTableBodyNone">Points to global build root, not <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>'s   </td><td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/PROJECT-NAME_BINARY_DIR.html"><code>Halide_BINARY_DIR</code></a> or <a href="https://cmake.org/cmake/help/latest/variable/PROJECT_BINARY_DIR.html"><code>PROJECT_BINARY_DIR</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_MAKE_PROGRAM.html"><code>CMAKE_MAKE_PROGRAM</code></a>   </td><td class="markdownTableBodyNone">CMake abstracts over differences in the build tool.   </td><td class="markdownTableBodyNone">Prefer CTest's build and test mode or CMake's <code>--build</code> mode    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/CMAKE_CROSSCOMPILING.html"><code>CMAKE_CROSSCOMPILING</code></a>   </td><td class="markdownTableBodyNone">Often misleading.   </td><td class="markdownTableBodyNone">Inspect relevant variables directly, eg. <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_SYSTEM_NAME.html"><code>CMAKE_SYSTEM_NAME</code></a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a href="https://cmake.org/cmake/help/latest/variable/BUILD_SHARED_LIBS.html"><code>BUILD_SHARED_LIBS</code></a>   </td><td class="markdownTableBodyNone">Could override user setting   </td><td class="markdownTableBodyNone">None, but be careful to restore value when overriding for a dependency   </td></tr>
</table>
<p>Any use of these functions or variables will block a PR.</p>
<h1><a class="anchor" id="adding-tests"></a>
Adding tests</h1>
<p>When adding a file to any of the folders under <code>test</code>, be aware that CI expects that every <code>.c</code> and <code>.cpp</code> appears in the <code>CMakeLists.txt</code> file <em>on its own line</em>, possibly as a comment. This is to avoid globbing and also to ensure that added files are not missed.</p>
<p>For most test types, it should be as simple as adding to the existing lists, which must remain in alphabetical order. Generator tests are trickier, but following the existing examples is a safe way to go.</p>
<h1><a class="anchor" id="adding-apps"></a>
Adding apps</h1>
<p>If you're contributing a new app to <a class="el" href="namespace_halide.html" title="This file defines the class FunctionDAG, which is our representation of a Halide pipeline,...">Halide</a>: great! Thank you! There are a few guidelines you should follow when writing a new app.</p>
<ul>
<li>Write the app as if it were a top-level project. You should call <code>find_package(Halide)</code> and set the C++ version to 11.</li>
<li>Call <a href="https://cmake.org/cmake/help/latest/command/enable_testing.html"><code>enable_testing()</code></a> and add a small test that runs the app.</li>
<li>Don't assume your app will have access to a GPU. Write your schedules to be robust to varying buildbot hardware.</li>
<li>Don't assume your app will be run on a specific OS, architecture, or bitness. Write your apps to be robust (ideally efficient) on all supported platforms.</li>
<li>If you rely on any additional packages, don't include them as <code>REQUIRED</code>, instead test to see if their targets are available and, if not, call <code>return()</code> before creating any targets. In this case, print a <code>message(STATUS "[SKIP] ...")</code>, too.</li>
<li>Look at the existing apps for examples.</li>
<li>Test your app with ctest before opening a PR. Apps are built as part of the test, rather than the main build. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
