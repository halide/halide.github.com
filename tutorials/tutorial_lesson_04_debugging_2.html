<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>
 Debugging with tracing, print, and print_when
</title>
<link rel="stylesheet" type="text/css" href="../assets/css/highlight.css">
<style>

a:visited {
color: #000000;
}

a:link {
color: #000000;
}

a:hover {
color: #aa0000;
}

</style>
</head>
<body class="hl" style="background-color: #444444; font-family: Helvetica, Arial, sans-serif;">
<script>
function toggle(id) {
    e = document.getElementById(id);
    show = document.getElementById(id + '-show');
    if (e.style.display != 'none') {
        e.style.display = 'none';
        show.innerHTML = "// Click to show output ...";
    } else {
        e.style.display = 'block';
        show.innerHTML = "// Click to hide output ...";
    }
    return false;
}
</script>
<div>
<style scoped>
@import "../assets/css/bootstrap.css";
</style>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="/index.html">Halide</a>
      <div class="nav-collapse">
        <ul class="nav">
          <li><a href="/index.html#gettingstarted">Getting Started</a></li>
          <li><a href="/tutorials/tutorial_introduction.html">Tutorials</a></li>
          <li><a href="/index.html#publications">Publications</a></li>
          <li><a href="/index.html#resources">Resources</a></li>
          <li class="divider-vertical"></li>
          <li><a href="/docs">Docs</a></li>
          <li><a href="http://github.com/halide/Halide/issues">Bugs</a></li>
          <li><a href="http://github.com/halide/Halide/wiki">Wiki</a></li>
          <li class="divider-vertical"></li>
          <li><a href="http://stackoverflow.com/questions/tagged/halide"><i class="fa fa-stack-overflow"></i>/#halide</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div style='position:relative; width:900pt; top:60px;'>
<div style="width:200px; float:left; ">
<a href="tutorial_introduction.html" style="text-decoration:none;" ><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px;
background-color: #dddddd; 
text-align: left; ">
<b>
00
&nbsp</b>
Introduction
</div>
</span>
</a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_01_basics.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
01
&nbsp</b>
 Getting started with Funcs, Vars, and Exprs
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_02_input_image.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
02
&nbsp</b>
 Processing images
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_03_debugging_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
03
&nbsp</b>
 Inspecting the generated code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_04_debugging_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; padding-right:40px; background-color: #ffffff; color: #000000; text-align: left; ">
<b>
04
&nbsp</b>
 Debugging with tracing, print, and print_when
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_05_scheduling_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
05
&nbsp</b>
 Vectorize, parallelize, unroll and tile your code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_06_realizing_over_shifted_domains.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
06
&nbsp</b>
 Realizing Funcs over arbitrary domains
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_07_multi_stage_pipelines.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
07
&nbsp</b>
 Multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_08_scheduling_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
08
&nbsp</b>
 Scheduling multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_09_update_definitions.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
09
&nbsp</b>
 Multi-pass Funcs, update definitions, and reductions
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_11_cross_compilation.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
11
&nbsp</b>
 Cross-compilation
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_12_using_the_gpu.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
12
&nbsp</b>
 Using the GPU
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_13_tuples.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
13
&nbsp</b>
 Tuples
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_14_types.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
14
&nbsp</b>
 The Halide type system
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_15_generators.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
15
&nbsp</b>
 Generators part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_15_generators_usage.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
15
&nbsp</b>
 Generators part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_16_rgb_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
16
&nbsp</b>
 RGB images and memory layouts part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_16_rgb_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
16
&nbsp</b>
 RGB images and memory layouts part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_17_predicated_rdom.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
17
&nbsp</b>
 Reductions over non-rectangular domains
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_18_parallel_associative_reductions.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
18
&nbsp</b>
 Factoring an associative reduction using rfactor
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_19_wrapper_funcs.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
19
&nbsp</b>
 Wrapper Funcs
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_20_cloning_funcs.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
20
&nbsp</b>
 Cloning Funcs
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_21_auto_scheduler_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
21
&nbsp</b>
 Auto-Scheduler
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_21_auto_scheduler_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
21
&nbsp</b>
 Auto-Scheduler
</div></span></a>
</div>
<div style="position:relative; margin-left:260px; padding:20px; background-color: #ffffff;">
<pre class="hl">
<span class="hl slc">// Halide tutorial lesson 4: Debugging with tracing, print, and print_when</span>

<span class="hl slc">// This lesson demonstrates how to follow what Halide is doing at runtime.</span>

<span class="hl slc">// On linux, you can compile and run it like so:</span>
<span class="hl slc">// g++ lesson_04*.cpp -g -I &lt;path/to/Halide.h&gt; -L &lt;path/to/libHalide.so&gt; -lHalide -lpthread -ldl -o lesson_04 -std=c++17</span>
<span class="hl slc">// LD_LIBRARY_PATH=&lt;path/to/libHalide.so&gt; ./lesson_04</span>

<span class="hl slc">// On os x:</span>
<span class="hl slc">// g++ lesson_04*.cpp -g -I &lt;path/to/Halide.h&gt; -L &lt;path/to/libHalide.so&gt; -lHalide -o lesson_04 -std=c++17</span>
<span class="hl slc">// DYLD_LIBRARY_PATH=&lt;path/to/libHalide.dylib&gt; ./lesson_04</span>

<span class="hl slc">// If you have the entire Halide source tree, you can also build it by</span>
<span class="hl slc">// running:</span>
<span class="hl slc">//    make tutorial_lesson_04_debugging_2</span>
<span class="hl slc">// in a shell with the current directory at the top of the halide</span>
<span class="hl slc">// source tree.</span>

<span class="hl ppc">#include</span> <span class="hl pps">&quot;Halide.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include &lt;stdio.h&gt;</span>
<span class="hl kwa">using namespace</span> Halide<span class="hl opt">;</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">(</span><span class="hl kwb">int</span> argc<span class="hl opt">,</span> <span class="hl kwb">char</span> <span class="hl opt">**</span>argv<span class="hl opt">) {</span>

    Var <span class="hl kwd">x</span><span class="hl opt">(</span><span class="hl str">&quot;x&quot;</span><span class="hl opt">),</span> <span class="hl kwd">y</span><span class="hl opt">(</span><span class="hl str">&quot;y&quot;</span><span class="hl opt">);</span>

    <span class="hl slc">// Printing out the value of Funcs as they are computed.</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// We&apos;ll define our gradient function as before.</span>
        Func <span class="hl kwd">gradient</span><span class="hl opt">(</span><span class="hl str">&quot;gradient&quot;</span><span class="hl opt">);</span>
        <span class="hl kwd">gradient</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> x <span class="hl opt">+</span> y<span class="hl opt">;</span>

        <span class="hl slc">// And tell Halide that we&apos;d like to be notified of all</span>
        <span class="hl slc">// evaluations.</span>
        gradient<span class="hl opt">.</span><span class="hl kwd">trace_stores</span><span class="hl opt">();</span>

        <span class="hl slc">// Realize the function over an 8x8 region.</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Evaluating gradient</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        Buffer<span class="hl opt">&lt;</span><span class="hl kwb">int</span><span class="hl opt">&gt;</span> output <span class="hl opt">=</span> gradient<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">8</span><span class="hl opt">,</span> <span class="hl num">8</span><span class="hl opt">});</span>
        <a onclick='return toggle("_39");'><b id=_39-show>// Click to show output ...</b></a><div id=_39 style= "display:none; background:#333333; color:#ffffff"><b>
 > Begin pipeline gradient.0()
 > Tag gradient.0() tag = "func_type_and_dim: 1 0 32 1 2 0 8 0 8"
 > Store gradient.0(0, 0) = 0
 > Store gradient.0(1, 0) = 1
 > Store gradient.0(2, 0) = 2
 > Store gradient.0(3, 0) = 3
 > Store gradient.0(4, 0) = 4
 > Store gradient.0(5, 0) = 5
 > Store gradient.0(6, 0) = 6
 > Store gradient.0(7, 0) = 7
 > Store gradient.0(0, 1) = 1
 > Store gradient.0(1, 1) = 2
 > Store gradient.0(2, 1) = 3
 > Store gradient.0(3, 1) = 4
 > Store gradient.0(4, 1) = 5
 > Store gradient.0(5, 1) = 6
 > Store gradient.0(6, 1) = 7
 > Store gradient.0(7, 1) = 8
 > Store gradient.0(0, 2) = 2
 > Store gradient.0(1, 2) = 3
 > Store gradient.0(2, 2) = 4
 > Store gradient.0(3, 2) = 5
 > Store gradient.0(4, 2) = 6
 > Store gradient.0(5, 2) = 7
 > Store gradient.0(6, 2) = 8
 > Store gradient.0(7, 2) = 9
 > Store gradient.0(0, 3) = 3
 > Store gradient.0(1, 3) = 4
 > Store gradient.0(2, 3) = 5
 > Store gradient.0(3, 3) = 6
 > Store gradient.0(4, 3) = 7
 > Store gradient.0(5, 3) = 8
 > Store gradient.0(6, 3) = 9
 > Store gradient.0(7, 3) = 10
 > Store gradient.0(0, 4) = 4
 > Store gradient.0(1, 4) = 5
 > Store gradient.0(2, 4) = 6
 > Store gradient.0(3, 4) = 7
 > Store gradient.0(4, 4) = 8
 > Store gradient.0(5, 4) = 9
 > Store gradient.0(6, 4) = 10
 > Store gradient.0(7, 4) = 11
 > Store gradient.0(0, 5) = 5
 > Store gradient.0(1, 5) = 6
 > Store gradient.0(2, 5) = 7
 > Store gradient.0(3, 5) = 8
 > Store gradient.0(4, 5) = 9
 > Store gradient.0(5, 5) = 10
 > Store gradient.0(6, 5) = 11
 > Store gradient.0(7, 5) = 12
 > Store gradient.0(0, 6) = 6
 > Store gradient.0(1, 6) = 7
 > Store gradient.0(2, 6) = 8
 > Store gradient.0(3, 6) = 9
 > Store gradient.0(4, 6) = 10
 > Store gradient.0(5, 6) = 11
 > Store gradient.0(6, 6) = 12
 > Store gradient.0(7, 6) = 13
 > Store gradient.0(0, 7) = 7
 > Store gradient.0(1, 7) = 8
 > Store gradient.0(2, 7) = 9
 > Store gradient.0(3, 7) = 10
 > Store gradient.0(4, 7) = 11
 > Store gradient.0(5, 7) = 12
 > Store gradient.0(6, 7) = 13
 > Store gradient.0(7, 7) = 14
 > End pipeline gradient.0()

</b></div>

        <span class="hl slc">// This will print out all the times gradient(x, y) gets</span>
        <span class="hl slc">// evaluated.</span>

        <span class="hl slc">// Now that we can snoop on what Halide is doing, let&apos;s try our</span>
        <span class="hl slc">// first scheduling primitive. We&apos;ll make a new version of</span>
        <span class="hl slc">// gradient that processes each scanline in parallel.</span>
        Func <span class="hl kwd">parallel_gradient</span><span class="hl opt">(</span><span class="hl str">&quot;parallel_gradient&quot;</span><span class="hl opt">);</span>
        <span class="hl kwd">parallel_gradient</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> x <span class="hl opt">+</span> y<span class="hl opt">;</span>

        <span class="hl slc">// We&apos;ll also trace this function.</span>
        parallel_gradient<span class="hl opt">.</span><span class="hl kwd">trace_stores</span><span class="hl opt">();</span>

        <span class="hl slc">// Things are the same so far. We&apos;ve defined the algorithm, but</span>
        <span class="hl slc">// haven&apos;t said anything about how to schedule it. In general,</span>
        <span class="hl slc">// exploring different scheduling decisions doesn&apos;t change the code</span>
        <span class="hl slc">// that describes the algorithm.</span>

        <span class="hl slc">// Now we tell Halide to use a parallel for loop over the y</span>
        <span class="hl slc">// coordinate. On Linux we run this using a thread pool and a task</span>
        <span class="hl slc">// queue. On OS X we call into grand central dispatch, which does</span>
        <span class="hl slc">// the same thing for us.</span>
        parallel_gradient<span class="hl opt">.</span><span class="hl kwd">parallel</span><span class="hl opt">(</span>y<span class="hl opt">);</span>

        <span class="hl slc">// This time the printfs should come out of order, because each</span>
        <span class="hl slc">// scanline is potentially being processed in a different</span>
        <span class="hl slc">// thread. The number of threads should adapt to your system, but</span>
        <span class="hl slc">// on linux you can control it manually using the environment</span>
        <span class="hl slc">// variable HL_NUM_THREADS.</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">Evaluating parallel_gradient</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        parallel_gradient<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">8</span><span class="hl opt">,</span> <span class="hl num">8</span><span class="hl opt">});</span>
        <a onclick='return toggle("_70");'><b id=_70-show>// Click to show output ...</b></a><div id=_70 style= "display:none; background:#333333; color:#ffffff"><b>
 > Begin pipeline parallel_gradient.0()
 > Tag parallel_gradient.0() tag = "func_type_and_dim: 1 0 32 1 2 0 8 0 8"
 > Store parallel_gradient.0(0, 0) = 0
 > Store parallel_gradient.0(1, 0) = 1
 > Store parallel_gradient.0(2, 0) = 2
 > Store parallel_gradient.0(3, 0) = 3
 > Store parallel_gradient.0(4, 0) = 4
 > Store parallel_gradient.0(5, 0) = 5
 > Store parallel_gradient.0(6, 0) = 6
 > Store parallel_gradient.0(7, 0) = 7
 > Store parallel_gradient.0(0, 4) = 4
 > Store parallel_gradient.0(1, 4) = 5
 > Store parallel_gradient.0(2, 4) = 6
 > Store parallel_gradient.0(3, 4) = 7
 > Store parallel_gradient.0(4, 4) = 8
 > Store parallel_gradient.0(5, 4) = 9
 > Store parallel_gradient.0(6, 4) = 10
 > Store parallel_gradient.0(7, 4) = 11
 > Store parallel_gradient.0(0, 5) = 5
 > Store parallel_gradient.0(1, 5) = 6
 > Store parallel_gradient.0(2, 5) = 7
 > Store parallel_gradient.0(3, 5) = 8
 > Store parallel_gradient.0(4, 5) = 9
 > Store parallel_gradient.0(5, 5) = 10
 > Store parallel_gradient.0(6, 5) = 11
 > Store parallel_gradient.0(7, 5) = 12
 > Store parallel_gradient.0(0, 1) = 1
 > Store parallel_gradient.0(1, 1) = 2
 > Store parallel_gradient.0(2, 1) = 3
 > Store parallel_gradient.0(3, 1) = 4
 > Store parallel_gradient.0(4, 1) = 5
 > Store parallel_gradient.0(5, 1) = 6
 > Store parallel_gradient.0(6, 1) = 7
 > Store parallel_gradient.0(7, 1) = 8
 > Store parallel_gradient.0(0, 6) = 6
 > Store parallel_gradient.0(1, 6) = 7
 > Store parallel_gradient.0(2, 6) = 8
 > Store parallel_gradient.0(3, 6) = 9
 > Store parallel_gradient.0(4, 6) = 10
 > Store parallel_gradient.0(5, 6) = 11
 > Store parallel_gradient.0(0, 3) = 3
 > Store parallel_gradient.0(0, 7) = 7
 > Store parallel_gradient.0(6, 6) = 12
 > Store parallel_gradient.0(1, 3) = 4
 > Store parallel_gradient.0(1, 7) = 8
 > Store parallel_gradient.0(2, 3) = 5
 > Store parallel_gradient.0(7, 6) = 13
 > Store parallel_gradient.0(2, 7) = 9
 > Store parallel_gradient.0(3, 3) = 6
 > Store parallel_gradient.0(3, 7) = 10
 > Store parallel_gradient.0(4, 3) = 7
 > Store parallel_gradient.0(4, 7) = 11
 > Store parallel_gradient.0(5, 3) = 8
 > Store parallel_gradient.0(5, 7) = 12
 > Store parallel_gradient.0(6, 3) = 9
 > Store parallel_gradient.0(6, 7) = 13
 > Store parallel_gradient.0(7, 3) = 10
 > Store parallel_gradient.0(7, 7) = 14
 > Store parallel_gradient.0(0, 2) = 2
 > Store parallel_gradient.0(1, 2) = 3
 > Store parallel_gradient.0(2, 2) = 4
 > Store parallel_gradient.0(3, 2) = 5
 > Store parallel_gradient.0(4, 2) = 6
 > Store parallel_gradient.0(5, 2) = 7
 > Store parallel_gradient.0(6, 2) = 8
 > Store parallel_gradient.0(7, 2) = 9
 > End pipeline parallel_gradient.0()

</b></div>
    <span class="hl opt">}</span>

    <span class="hl slc">// Printing individual Exprs.</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// trace_stores() can only print the value of a</span>
        <span class="hl slc">// Func. Sometimes you want to inspect the value of</span>
        <span class="hl slc">// sub-expressions rather than the entire Func. The built-in</span>
        <span class="hl slc">// function &apos;print&apos; can be wrapped around any Expr to print</span>
        <span class="hl slc">// the value of that Expr every time it is evaluated.</span>

        <span class="hl slc">// For example, say we have some Func that is the sum of two terms:</span>
        Func f<span class="hl opt">;</span>
        <span class="hl kwd">f</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> <span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">);</span>

        <span class="hl slc">// If we want to inspect just one of the terms, we can wrap</span>
        <span class="hl slc">// &apos;print&apos; around it like so:</span>
        Func g<span class="hl opt">;</span>
        <span class="hl kwd">g</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> <span class="hl kwd">print</span><span class="hl opt">(</span><span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">));</span>

        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">Evaluating sin(x) + cos(y), and just printing cos(y)</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        g<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">4</span><span class="hl opt">,</span> <span class="hl num">4</span><span class="hl opt">});</span>
        <a onclick='return toggle("_91");'><b id=_91-show>// Click to show output ...</b></a><div id=_91 style= "display:none; background:#333333; color:#ffffff"><b>
 > 1.000000
 > 1.000000
 > 1.000000
 > 1.000000
 > 0.540302
 > 0.540302
 > 0.540302
 > 0.540302
 > -0.416147
 > -0.416147
 > -0.416147
 > -0.416147
 > -0.989992
 > -0.989992
 > -0.989992
 > -0.989992

</b></div>
    <span class="hl opt">}</span>

    <span class="hl slc">// Printing additional context.</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// print can take multiple arguments. It prints all of them</span>
        <span class="hl slc">// and evaluates to the first one. The arguments can be Exprs</span>
        <span class="hl slc">// or constant strings. This can be used to print additional</span>
        <span class="hl slc">// context alongside the value:</span>
        Func f<span class="hl opt">;</span>
        <span class="hl kwd">f</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> <span class="hl kwd">print</span><span class="hl opt">(</span><span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">),</span> <span class="hl str">&quot;&lt;- this is cos(&quot;</span><span class="hl opt">,</span> y<span class="hl opt">,</span> <span class="hl str">&quot;) when x =&quot;</span><span class="hl opt">,</span> x<span class="hl opt">);</span>

        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">Evaluating sin(x) + cos(y), and printing cos(y) with more context</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        f<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">4</span><span class="hl opt">,</span> <span class="hl num">4</span><span class="hl opt">});</span>
        <a onclick='return toggle("_104");'><b id=_104-show>// Click to show output ...</b></a><div id=_104 style= "display:none; background:#333333; color:#ffffff"><b>
 > 1.000000 <- this is cos( 0 ) when x = 0
 > 1.000000 <- this is cos( 0 ) when x = 1
 > 1.000000 <- this is cos( 0 ) when x = 2
 > 1.000000 <- this is cos( 0 ) when x = 3
 > 0.540302 <- this is cos( 1 ) when x = 0
 > 0.540302 <- this is cos( 1 ) when x = 1
 > 0.540302 <- this is cos( 1 ) when x = 2
 > 0.540302 <- this is cos( 1 ) when x = 3
 > -0.416147 <- this is cos( 2 ) when x = 0
 > -0.416147 <- this is cos( 2 ) when x = 1
 > -0.416147 <- this is cos( 2 ) when x = 2
 > -0.416147 <- this is cos( 2 ) when x = 3
 > -0.989992 <- this is cos( 3 ) when x = 0
 > -0.989992 <- this is cos( 3 ) when x = 1
 > -0.989992 <- this is cos( 3 ) when x = 2
 > -0.989992 <- this is cos( 3 ) when x = 3

</b></div>

        <span class="hl slc">// It can be useful to split expressions like the one above</span>
        <span class="hl slc">// across multiple lines to make it easier to turn on and off</span>
        <span class="hl slc">// printing certain values while debugging.</span>
        Expr e <span class="hl opt">=</span> <span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">);</span>
        <span class="hl slc">// Uncomment the following line to print the value of cos(y)</span>
        <span class="hl slc">// e = print(e, &quot;&lt;- this is cos(&quot;, y, &quot;) when x =&quot;, x);</span>
        Func g<span class="hl opt">;</span>
        <span class="hl kwd">g</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> e<span class="hl opt">;</span>
        g<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">4</span><span class="hl opt">,</span> <span class="hl num">4</span><span class="hl opt">});</span>
    <span class="hl opt">}</span>

    <span class="hl slc">// Conditional printing</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// Both print and trace_stores can produce a lot of output. If</span>
        <span class="hl slc">// you&apos;re looking for a rare event, or just want to see what</span>
        <span class="hl slc">// happens at a single pixel, this amount of output can be</span>
        <span class="hl slc">// difficult to dig through. Instead, the function print_when</span>
        <span class="hl slc">// can be used to conditionally print an Expr. The first</span>
        <span class="hl slc">// argument to print_when is a boolean Expr. If the Expr</span>
        <span class="hl slc">// evaluates to true, it returns the second argument and</span>
        <span class="hl slc">// prints all of the arguments. If the Expr evaluates to false</span>
        <span class="hl slc">// it just returns the second argument and does not print.</span>

        Func f<span class="hl opt">;</span>
        Expr e <span class="hl opt">=</span> <span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">);</span>
        e <span class="hl opt">=</span> <span class="hl kwd">print_when</span><span class="hl opt">(</span>x <span class="hl opt">==</span> <span class="hl num">37</span> <span class="hl opt">&amp;&amp;</span> y <span class="hl opt">==</span> <span class="hl num">42</span><span class="hl opt">,</span> e<span class="hl opt">,</span> <span class="hl str">&quot;&lt;- this is cos(y) at x, y == (37, 42)&quot;</span><span class="hl opt">);</span>
        <span class="hl kwd">f</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> e<span class="hl opt">;</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">Evaluating sin(x) + cos(y), and printing cos(y) at a single pixel</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        f<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">640</span><span class="hl opt">,</span> <span class="hl num">480</span><span class="hl opt">});</span>
        <a onclick='return toggle("_134");'><b id=_134-show>// Click to show output ...</b></a><div id=_134 style= "display:none; background:#333333; color:#ffffff"><b>
 > -0.399985 <- this is cos(y) at x, y == (37, 42)

</b></div>

        <span class="hl slc">// print_when can also be used to check for values you&apos;re not expecting:</span>
        Func g<span class="hl opt">;</span>
        e <span class="hl opt">=</span> <span class="hl kwd">cos</span><span class="hl opt">(</span>y<span class="hl opt">);</span>
        e <span class="hl opt">=</span> <span class="hl kwd">print_when</span><span class="hl opt">(</span>e <span class="hl opt">&lt;</span> <span class="hl num">0</span><span class="hl opt">,</span> e<span class="hl opt">,</span> <span class="hl str">&quot;cos(y) &lt; 0 at y ==&quot;</span><span class="hl opt">,</span> y<span class="hl opt">);</span>
        <span class="hl kwd">g</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">sin</span><span class="hl opt">(</span>x<span class="hl opt">) +</span> e<span class="hl opt">;</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">Evaluating sin(x) + cos(y), and printing whenever cos(y) &lt; 0</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        g<span class="hl opt">.</span><span class="hl kwd">realize</span><span class="hl opt">({</span><span class="hl num">4</span><span class="hl opt">,</span> <span class="hl num">4</span><span class="hl opt">});</span>
        <a onclick='return toggle("_142");'><b id=_142-show>// Click to show output ...</b></a><div id=_142 style= "display:none; background:#333333; color:#ffffff"><b>
 > -0.416147 cos(y) < 0 at y == 2
 > -0.416147 cos(y) < 0 at y == 2
 > -0.416147 cos(y) < 0 at y == 2
 > -0.416147 cos(y) < 0 at y == 2
 > -0.989992 cos(y) < 0 at y == 3
 > -0.989992 cos(y) < 0 at y == 3
 > -0.989992 cos(y) < 0 at y == 3
 > -0.989992 cos(y) < 0 at y == 3

</b></div>
    <span class="hl opt">}</span>

    <span class="hl slc">// Printing expressions at compile-time.</span>
    <span class="hl opt">{</span>
        <span class="hl slc">// The code above builds up a Halide Expr across several lines</span>
        <span class="hl slc">// of code. If you&apos;re programmatically constructing a complex</span>
        <span class="hl slc">// expression, and you want to check the Expr you&apos;ve created</span>
        <span class="hl slc">// is what you think it is, you can also print out the</span>
        <span class="hl slc">// expression itself using C++ streams:</span>
        Var <span class="hl kwd">fizz</span><span class="hl opt">(</span><span class="hl str">&quot;fizz&quot;</span><span class="hl opt">),</span> <span class="hl kwd">buzz</span><span class="hl opt">(</span><span class="hl str">&quot;buzz&quot;</span><span class="hl opt">);</span>
        Expr e <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
        <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">2</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
            <span class="hl kwa">if</span> <span class="hl opt">(</span>i <span class="hl opt">%</span> <span class="hl num">3</span> <span class="hl opt">==</span> <span class="hl num">0</span> <span class="hl opt">&amp;&amp;</span> i <span class="hl opt">%</span> <span class="hl num">5</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">) {</span>
                e <span class="hl opt">+=</span> fizz <span class="hl opt">*</span> buzz<span class="hl opt">;</span>
            <span class="hl opt">}</span> <span class="hl kwa">else if</span> <span class="hl opt">(</span>i <span class="hl opt">%</span> <span class="hl num">3</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">) {</span>
                e <span class="hl opt">+=</span> fizz<span class="hl opt">;</span>
            <span class="hl opt">}</span> <span class="hl kwa">else if</span> <span class="hl opt">(</span>i <span class="hl opt">%</span> <span class="hl num">5</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl opt">) {</span>
                e <span class="hl opt">+=</span> buzz<span class="hl opt">;</span>
            <span class="hl opt">}</span> <span class="hl kwa">else</span> <span class="hl opt">{</span>
                e <span class="hl opt">+=</span> i<span class="hl opt">;</span>
            <span class="hl opt">}</span>
        <span class="hl opt">}</span>
        <span class="hl kwc">std</span><span class="hl opt">::</span>cout <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;Printing a complex Expr: &quot;</span> <span class="hl opt">&lt;&lt;</span> e <span class="hl opt">&lt;&lt;</span> <span class="hl str">&quot;</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">;</span>
        <a onclick='return toggle("_165");'><b id=_165-show>// Click to show output ...</b></a><div id=_165 style= "display:none; background:#333333; color:#ffffff"><b>
 > Printing a complex Expr: ((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((((1 + 2) + fizz) + 4) + buzz) + fizz) + 7) + 8) + fizz) + buzz) + 11) + fizz) + 13) + 14) + (fizz*buzz)) + 16) + 17) + fizz) + 19) + buzz) + fizz) + 22) + 23) + fizz) + buzz) + 26) + fizz) + 28) + 29) + (fizz*buzz)) + 31) + 32) + fizz) + 34) + buzz) + fizz) + 37) + 38) + fizz) + buzz) + 41) + fizz) + 43) + 44) + (fizz*buzz)) + 46) + 47) + fizz) + 49) + buzz) + fizz) + 52) + 53) + fizz) + buzz) + 56) + fizz) + 58) + 59) + (fizz*buzz)) + 61) + 62) + fizz) + 64) + buzz) + fizz) + 67) + 68) + fizz) + buzz) + 71) + fizz) + 73) + 74) + (fizz*buzz)) + 76) + 77) + fizz) + 79) + buzz) + fizz) + 82) + 83) + fizz) + buzz) + 86) + fizz) + 88) + 89) + (fizz*buzz)) + 91) + 92) + fizz) + 94) + buzz) + fizz) + 97) + 98) + fizz)

</b></div>
    <span class="hl opt">}</span>

    <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Success!</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl opt">}</span>
</pre>
</div></body></html>
